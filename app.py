import streamlit as st
import time

# –ë–µ—Ç—Ç—ñ“£ –±–∞–ø—Ç–∞—É–ª–∞—Ä—ã
st.set_page_config(page_title="Chemistry AI Lab", layout="wide")

# --- CSS –ê–ù–ò–ú–ê–¶–ò–Ø–°–´ ---
st.markdown("""
<style>
    .scene { display: flex; justify-content: center; align-items: flex-end; height: 250px; gap: 40px; padding-bottom: 20px; }
    .side-tube { width: 35px; height: 130px; border: 3px solid #eee; border-radius: 0 0 20px 20px; position: relative; transition: all 1.5s ease; }
    .main-tube { width: 60px; height: 160px; border: 4px solid #fff; border-radius: 0 0 30px 30px; position: relative; background: rgba(255,255,255,0.1); }
    
    .liquid-left { background: #FF4B4B; width: 100%; height: 60%; position: absolute; bottom: 0; border-radius: 0 0 15px 15px; }
    .liquid-right { background: #1F77B4; width: 100%; height: 60%; position: absolute; bottom: 0; border-radius: 0 0 15px 15px; }
    .liquid-center { background: #9B59B6; width: 100%; height: 0%; position: absolute; bottom: 0; border-radius: 0 0 25px 25px; transition: height 2s ease 1s; }

    .pour-left { transform: rotate(70deg) translate(30px, -20px); opacity: 0.5; }
    .pour-right { transform: rotate(-70deg) translate(-30px, -20px); opacity: 0.5; }
    .fill-up { height: 80% !important; }
</style>
""", unsafe_allow_html=True)

# ---------------- –ú”ò–õ–Ü–ú–ï–¢–¢–ï–† “ö–û–†–´ (34 —Å–∞–±–∞“õ —à–∞–±–ª–æ–Ω—ã–º–µ–Ω) ----------------
lesson_data = {
    1: {
        "topic": "–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ —Å–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è—Å—ã (Br‚ÇÇ)",
        "theory": "–ê–ª–∫–µ–Ω–¥–µ—Ä –±—Ä–æ–º —Å—É—ã–º–µ–Ω ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Å–∫–µ–Ω–¥–µ “õ–æ—Å—ã–ª—É —Ä–µ–∞–∫—Ü–∏—è—Å—ã–Ω–∞ —Ç“Ø—Å—ñ–ø, –æ–Ω—ã —Ç“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–µ–¥—ñ.",
        "lab": ("–ë—Ä–æ–º —Å—É—ã (Br‚ÇÇ)", "“ö—ã–∑—ã–ª-“õ–æ“£—ã—Ä —Ç“Ø—Å—Ç—ñ“£ –∂–æ–π—ã–ª—É—ã", "“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω –µ—Å–µ–ª—ñ –±–∞–π–ª–∞–Ω—ã—Å –±–∞—Ä"),
        "test": [
            ("–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ –∂–∞–ª–ø—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["CnH2n+2", "CnH2n", "CnH2n-2"], 1),
            ("–ë—Ä–æ–º —Å—É—ã–Ω—ã“£ —Ç“Ø—Å—ñ “õ–∞–Ω–¥–∞–π?", ["–ö”©–∫", "–¢“Ø—Å—Å—ñ–∑", "“ö—ã–∑—ã–ª-“õ–æ“£—ã—Ä"], 2),
            ("–†–µ–∞–∫—Ü–∏—è –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω–¥–µ –Ω–µ –±–æ–ª–∞–¥—ã?", ["–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É", "–¢“±–Ω–±–∞ —Ç“Ø—Å—É", "–ì–∞–∑ –±”©–ª—ñ–Ω—É"], 0),
            ("–≠—Ç–∏–ª–µ–Ω –±—Ä–æ–º–º–µ–Ω ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Å–∫–µ–Ω–¥–µ –Ω–µ —Ç“Ø–∑—ñ–ª–µ–¥—ñ?", ["–î–∏–±—Ä–æ–º—ç—Ç–∞–Ω", "–ë—Ä–æ–º—ç—Ç–∞–Ω", "–≠—Ç–∞–Ω"], 0),
            ("“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω–¥—ã“õ –±–µ–ª–≥—ñ—Å—ñ?", ["–ñ–∞–Ω—É", "–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É", "–ò—ñ—Å"], 1),
            ("“ö–∞–π –∑–∞—Ç –±—Ä–æ–º —Å—É—ã–Ω —Ç“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–º–µ–π–¥—ñ?", ["–≠—Ç–∞–Ω", "–≠—Ç–µ–Ω", "–ê—Ü–µ—Ç–∏–ª–µ–Ω"], 0),
            ("–ë—Ä–æ–º —Å—É—ã–º–µ–Ω —Ä–µ–∞–∫—Ü–∏—è —Ç“Ø—Ä—ñ?", ["–û—Ä—ã–Ω–±–∞—Å—É", "“ö–æ—Å—ã–ª—É", "–ê–π—ã—Ä—ã–ª—É"], 1),
            ("C‚ÇÇH‚ÇÑ “õ–∞–π –∫–ª–∞—Å—Å“õ–∞ –∂–∞—Ç–∞–¥—ã?", ["–ê–ª–∫–∞–Ω", "–ê–ª–∫–µ–Ω", "–ê–ª–∫–∏–Ω"], 1),
            ("KMnO‚ÇÑ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ—Å—ñ–º–µ–Ω –¥–µ –æ—Å—ã–ª–∞–π –±–æ–ª–∞ –º–∞?", ["–ò”ô", "–ñ–æ“õ", "–ë—ñ–ª–º–µ–π–º—ñ–Ω"], 0),
            ("–ë—Ä–æ–º–Ω—ã“£ —Ö–∏–º–∏—è–ª—ã“õ —Å–∏–º–≤–æ–ª—ã?", ["Br", "B", "Ba"], 0)
        ]
    },
    2: {
        "topic": "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä",
        "theory": "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ –∂–∞“£–∞ –¥–∞–π—ã–Ω–¥–∞–ª“ì–∞–Ω –º—ã—Å (II) –≥–∏–¥—Ä–æ–∫—Å–∏–¥—ñ–º–µ–Ω –∞–Ω—ã“õ—Ç–∞–π–¥—ã.",
        "lab": ("Cu(OH)‚ÇÇ", "–ê—à—ã“õ –∫”©–∫ —Ç“Ø—Å—Ç—ñ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ", "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç –∞–Ω—ã“õ—Ç–∞–ª–¥—ã"),
        "test": [
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–Ω—ñ“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["C‚ÇÉH‚ÇàO‚ÇÉ", "C‚ÇÇH‚ÇÜO", "CH‚ÇÑO"], 0),
            ("–°–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ“£ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–±—ã?", ["-OH", "-CHO", "-COOH"], 1),
            ("Cu(OH)‚ÇÇ —Ç“Ø—Å—ñ “õ–∞–Ω–¥–∞–π?", ["–ñ–∞—Å—ã–ª", "–ö”©–∫", "“ö—ã–∑—ã–ª"], 1),
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω –Ω–µ—à–µ –∞—Ç–æ–º–¥—ã?", ["1", "2", "3"], 2),
            ("–ú—ã—Å (II) –≥–∏–¥—Ä–æ–∫—Å–∏–¥—ñ–Ω “õ–∞–ª–∞–π –∞–ª–∞–¥—ã?", ["Cu+H2O", "CuSO4+NaOH", "CuO+HCl"], 1),
            ("–†–µ–∞–∫—Ü–∏—è –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω–¥–µ–≥—ñ —Ç“Ø—Å?", ["–ê—à—ã“õ –∫”©–∫", "–°–∞—Ä—ã", "“ö–∞—Ä–∞"], 0),
            ("–ë—ñ—Ä –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç –±“±–ª —Ä–µ–∞–∫—Ü–∏—è–Ω—ã –±–µ—Ä–µ –º–µ?", ["–ñ–æ“õ", "–ò”ô", "–¢–µ–∫ “õ—ã–∑–¥—ã—Ä“ì–∞–Ω–¥–∞"], 0),
            ("–¢“±—Ç“õ—ã—Ä, —Ç”ô—Ç—Ç—ñ —Å“±–π—ã“õ—Ç—ã“õ?", ["–ì–ª–∏—Ü–µ—Ä–∏–Ω", "–≠—Ç–∞–Ω–æ–ª", "–ú–µ—Ç–∞–Ω"], 0),
            ("–°–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ“£ –∂—ñ–∫—Ç–µ–ª—É—ñ?", ["–ê—Ç–æ–º —Å–∞–Ω—ã–Ω–∞ “õ–∞—Ä–∞–π", "–¢“Ø—Å—ñ–Ω–µ “õ–∞—Ä–∞–π", "–°–∞–ª–º–∞“ì—ã–Ω–∞ “õ–∞—Ä–∞–π"], 0),
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω “õ–∞–π–¥–∞ “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã?", ["–ö–æ—Å–º–µ—Ç–∏–∫–∞", "“ö“±—Ä—ã–ª—ã—Å", "–ú–µ—Ç–∞–ª–ª –∞–ª—É"], 0)
        ]
    }
}

# “ö–∞–ª“ì–∞–Ω —Å–∞–±–∞“õ—Ç–∞—Ä–¥—ã –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ —Ç–æ–ª—Ç—ã—Ä—É (“õ–∞—Ç–µ —à—ã“õ–ø–∞—É—ã “Ø—à—ñ–Ω)
for i in range(3, 35):
    lesson_data[i] = {
        "topic": f"{i}-—Å–∞–±–∞“õ —Ç–∞“õ—ã—Ä—ã–±—ã",
        "theory": f"{i}-—Å–∞–±–∞“õ—Ç—ã“£ —Ç–µ–æ—Ä–∏—è–ª—ã“õ –º–∞–∑–º“±–Ω—ã.",
        "lab": ("–†–µ–∞–∫—Ç–∏–≤—Ç–µ—Ä", "–ë–∞“õ—ã–ª–∞—É –±–µ–ª–≥—ñ—Å—ñ", "“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã"),
        "test": [(f"–°“±—Ä–∞“õ {j}", ["–ñ–∞—É–∞–ø 1", "–ñ–∞—É–∞–ø 2", "–ñ–∞—É–∞–ø 3"], 0) for j in range(1, 11)]
    }

# ---------------- –ò–ù–¢–ï–†–§–ï–ô–° ----------------
st.sidebar.title("üìò –•–∏–º–∏—è –∫—É—Ä—Å—ã")
lesson_selected = st.sidebar.selectbox("–°–∞–±–∞“õ—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑", [f"{i}-—Å–∞–±–∞“õ" for i in range(1, 35)])
lesson_num = int(lesson_selected.split("-")[0])

data = lesson_data[lesson_num]

st.title(f"üß™ {data['topic']}")

# –¢–∞–±—Ç–∞—Ä–¥—ã “õ“±—Ä—É
tab1, tab2, tab3 = st.tabs(["üìñ –¢–µ–æ—Ä–∏—è", "üî¨ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç", "üìù –¢–µ—Å—Ç (10 —Å“±—Ä–∞“õ)"])

with tab1:
    st.info(data['theory'])

with tab2:
    st.subheader("–í–∏—Ä—Ç—É–∞–ª–¥—ã –∑–µ—Ä—Ç—Ö–∞–Ω–∞")
    
    if 'poured' not in st.session_state:
        st.session_state.poured = False

    l_class = "pour-left" if st.session_state.poured else ""
    r_class = "pour-right" if st.session_state.poured else ""
    c_class = "fill-up" if st.session_state.poured else ""

    st.markdown(f"""
    <div class="scene">
        <div class="side-tube {l_class}"><div class="liquid-left"></div></div>
        <div class="main-tube"><div class="liquid-center {c_class}"></div></div>
        <div class="side-tube {r_class}"><div class="liquid-right"></div></div>
    </div>
    """, unsafe_allow_html=True)

    col1, col2 = st.columns(2)
    with col1:
        if st.button("–†–µ–∞–∫—Ü–∏—è–Ω—ã –±–∞—Å—Ç–∞—É"):
            st.session_state.poured = True
            st.rerun()
        if st.button("–¢–∞–∑–∞–ª–∞—É"):
            st.session_state.poured = False
            st.rerun()
    
    with col2:
        if st.session_state.poured:
            st.success(f"**–ë–∞“õ—ã–ª–∞—É:** {data['lab'][1]}")
            st.warning(f"**“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã:** {data['lab'][2]}")

with tab3:
    st.subheader("–ë—ñ–ª—ñ–º—ñ“£–¥—ñ —Ç–µ–∫—Å–µ—Ä")
    score = 0
    # –¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Å—ã (st.form_submit_button “õ–æ–ª–¥–∞–Ω—ã–ª–¥—ã)
    with st.form(key=f"test_form_{lesson_num}"):
        for idx, (q, opts, corr) in enumerate(data["test"]):
            ans = st.radio(f"{idx+1}. {q}", opts, key=f"q_{lesson_num}_{idx}")
            if opts.index(ans) == corr:
                score += 1
        
        # –û–°–´ –ñ–ï–†–î–ï–ì–Ü “ö–ê–¢–ï –¢“Æ–ó–ï–¢–Ü–õ–î–Ü:
        submit = st.form_submit_button("–ù”ô—Ç–∏–∂–µ–Ω—ñ –µ—Å–µ–ø—Ç–µ—É")
        
        if submit:
            if score == 10:
                st.balloons()
                st.success(f"–ö–µ—Ä–µ–º–µ—Ç! 10/10 “±–ø–∞–π –∂–∏–Ω–∞–¥—ã“£—ã–∑!")
            else:
                st.write(f"–°—ñ–∑–¥—ñ“£ “±–ø–∞–π—ã“£—ã–∑: **{score} / 10**")

st.markdown("---")
st.caption("¬© Chemistry Lab + AI | –ë–∞—Ä–ª—ã“õ —Å–∞–±–∞“õ—Ç–∞—Ä –º–µ–Ω –∞–Ω–∏–º–∞—Ü–∏—è–ª–∞—Ä “õ–æ—Å—ã–ª“ì–∞–Ω")
