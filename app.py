import streamlit as st
import time

st.set_page_config(page_title="Chemistry AI Lab", layout="wide")

# --- CSS –ê–ù–ò–ú–ê–¶–ò–Ø (–î–≤–µ –ø—Ä–æ–±–∏—Ä–∫–∏ —Å–ª–∏–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω—É) ---
st.markdown("""
<style>
    .scene { display: flex; justify-content: center; align-items: flex-end; height: 250px; gap: 40px; padding-bottom: 20px; }
    .side-tube { width: 35px; height: 130px; border: 3px solid #eee; border-radius: 0 0 20px 20px; position: relative; transition: all 1.5s ease; }
    .main-tube { width: 60px; height: 160px; border: 4px solid #fff; border-radius: 0 0 30px 30px; position: relative; background: rgba(255,255,255,0.1); }
    
    .liquid-left { background: #FF4B4B; width: 100%; height: 60%; position: absolute; bottom: 0; border-radius: 0 0 15px 15px; }
    .liquid-right { background: #1F77B4; width: 100%; height: 60%; position: absolute; bottom: 0; border-radius: 0 0 15px 15px; }
    .liquid-center { background: #9B59B6; width: 100%; height: 0%; position: absolute; bottom: 0; border-radius: 0 0 25px 25px; transition: height 2s ease 1s; }

    /* –ö–ª–∞—Å—Å—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ */
    .pour-left { transform: rotate(70deg) translate(30px, -20px); opacity: 0.5; }
    .pour-right { transform: rotate(-70deg) translate(-30px, -20px); opacity: 0.5; }
    .fill-up { height: 80% !important; }
</style>
""", unsafe_allow_html=True)

# ---------------- –î–ê–ù–ù–´–ï –£–†–û–ö–û–í (–ü—Ä–∏–º–µ—Ä –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã) ----------------
# –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –∑–¥–µ—Å—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤—Å–µ 34 —É—Ä–æ–∫–∞
lesson_data = {
    1: {
        "topic": "–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ —Å–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è—Å—ã (Br‚ÇÇ)",
        "theory": "“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω –∫”©–º—ñ—Ä—Å—É—Ç–µ–∫—Ç–µ—Ä –±—Ä–æ–º —Å—É—ã–Ω —Ç“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–µ–¥—ñ.",
        "lab": ("–ë—Ä–æ–º —Å—É—ã (Br‚ÇÇ)", "“ö—ã–∑—ã–ª-“õ–æ“£—ã—Ä —Ç“Ø—Å—Ç—ñ“£ –∂–æ–π—ã–ª—É—ã", "–ï—Å–µ–ª—ñ –±–∞–π–ª–∞–Ω—ã—Å (C=C) –∞–Ω—ã“õ—Ç–∞–ª–¥—ã"),
        "test": [
            ("–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ –∂–∞–ª–ø—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["CnH2n+2", "CnH2n", "CnH2n-2"], 1),
            ("–ë—Ä–æ–º —Å—É—ã–Ω—ã“£ —Ç“Ø—Å—ñ “õ–∞–Ω–¥–∞–π?", ["–ö”©–∫", "–¢“Ø—Å—Å—ñ–∑", "“ö—ã–∑—ã–ª-“õ–æ“£—ã—Ä"], 2),
            ("–†–µ–∞–∫—Ü–∏—è –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω–¥–µ –Ω–µ –±–æ–ª–∞–¥—ã?", ["–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É", "–¢“±–Ω–±–∞ —Ç“Ø—Å—É", "–ì–∞–∑ –±”©–ª—ñ–Ω—É"], 0),
            ("–≠—Ç–∏–ª–µ–Ω –±—Ä–æ–º–º–µ–Ω ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Å–∫–µ–Ω–¥–µ –Ω–µ —Ç“Ø–∑—ñ–ª–µ–¥—ñ?", ["–î–∏–±—Ä–æ–º—ç—Ç–∞–Ω", "–ë—Ä–æ–º—ç—Ç–∞–Ω", "–≠—Ç–∞–Ω"], 0),
            ("“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω–¥—ã“õ –±–µ–ª–≥—ñ—Å—ñ?", ["–ñ–∞–Ω—É", "–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É", "–ò—ñ—Å"], 1),
            ("“ö–∞–π –∑–∞—Ç –±—Ä–æ–º —Å—É—ã–Ω —Ç“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–º–µ–π–¥—ñ?", ["–≠—Ç–∞–Ω", "–≠—Ç–µ–Ω", "–ê—Ü–µ—Ç–∏–ª–µ–Ω"], 0),
            ("–ë—Ä–æ–º —Å—É—ã–º–µ–Ω —Ä–µ–∞–∫—Ü–∏—è —Ç“Ø—Ä—ñ?", ["–û—Ä—ã–Ω–±–∞—Å—É", "“ö–æ—Å—ã–ª—É", "–ê–π—ã—Ä—ã–ª—É"], 1),
            ("C2H4 “õ–∞–π –∫–ª–∞—Å—Å?", ["–ê–ª–∫–∞–Ω", "–ê–ª–∫–µ–Ω", "–ê–ª–∫–∏–Ω"], 1),
            ("KMnO4 –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ—Å—ñ–º–µ–Ω –¥–µ –æ—Å—ã–ª–∞–π –±–æ–ª–∞ –º–∞?", ["–ò”ô", "–ñ–æ“õ", "–ë—ñ–ª–º–µ–π–º—ñ–Ω"], 0),
            ("–ë—Ä–æ–º —Å—É—ã–Ω—ã“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["Br2", "HBr", "NaBr"], 0)
        ]
    },
    2: {
        "topic": "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä (–ì–ª–∏—Ü–µ—Ä–∏–Ω)",
        "theory": "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä –∂–∞“£–∞ –¥–∞–π—ã–Ω–¥–∞–ª“ì–∞–Ω Cu(OH)‚ÇÇ-–º–µ–Ω –∞—à—ã“õ –∫”©–∫ —Ç“Ø—Å—Ç—ñ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ –±–µ—Ä–µ–¥—ñ.",
        "lab": ("CuSO‚ÇÑ + NaOH", "–ê—à—ã“õ –∫”©–∫ —Ç“Ø—Å—Ç—ñ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ —Ç“Ø–∑—ñ–ª—É—ñ", "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç (-OH —Ç–æ–ø—Ç–∞—Ä—ã)"),
        "test": [
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–¥–µ –Ω–µ—à–µ -OH —Ç–æ–±—ã –±–∞—Ä?", ["1", "2", "3"], 2),
            ("–°–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ“£ —Å–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ç–∏–≤—ñ?", ["Cu(OH)2", "AgNO3", "FeCl3"], 0),
            ("–ï—Ä—ñ—Ç—ñ–Ω–¥—ñ–Ω—ñ“£ —Ç“Ø—Å—ñ “õ–∞–Ω–¥–∞–π?", ["“ö—ã–∑—ã–ª", "–ê—à—ã“õ –∫”©–∫", "–°–∞—Ä—ã"], 1),
            ("Cu(OH)2 “õ–∞–ª–∞–π –∞–ª—ã–Ω–∞–¥—ã?", ["CuSO4 + NaOH", "Cu + H2O", "CuO + HCl"], 0),
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–Ω—ñ“£ —Ñ–∏–∑–∏–∫–∞–ª—ã“õ –∫“Ø–π—ñ?", ["–ì–∞–∑", "“ö–∞—Ç—Ç—ã", "–¢“±—Ç“õ—ã—Ä —Å“±–π—ã“õ—Ç—ã“õ"], 2),
            ("–ë—ñ—Ä –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç –±“±–ª —Ä–µ–∞–∫—Ü–∏—è–Ω—ã –±–µ—Ä–µ –º–µ?", ["–ò”ô", "–ñ–æ“õ", "“ö—ã–∑–¥—ã—Ä“ì–∞–Ω–¥–∞"], 1),
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω “õ–∞–π–¥–∞ “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã?", ["–ö–æ—Å–º–µ—Ç–∏–∫–∞", "–û—Ç—ã–Ω", "–ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è"], 0),
            ("–†–µ–∞–∫—Ü–∏—è –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω–¥–µ –Ω–µ —Ç“Ø–∑—ñ–ª–µ–¥—ñ?", ["–ú—ã—Å –≥–ª–∏—Ü–µ—Ä–∞—Ç—ã", "–ú—ã—Å –æ–∫—Å–∏–¥—ñ", "–°—É—Ç–µ–≥—ñ"], 0),
            ("–°–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ“£ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–±—ã?", ["-CHO", "-OH", "-COOH"], 1),
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–Ω—ñ“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["C3H8O3", "C2H6O", "CH4O"], 0)
        ]
    }
    # ... –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–æ 34 —É—Ä–æ–∫–∞
}

# –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —É—Ä–æ–∫–æ–≤ —à–∞–±–ª–æ–Ω–æ–º, —á—Ç–æ–±—ã –∫–æ–¥ –Ω–µ –≤—ã–¥–∞–≤–∞–ª –æ—à–∏–±–∫—É
for i in range(1, 35):
    if i not in lesson_data:
        lesson_data[i] = {
            "topic": f"{i}-—à—ñ –∑–µ—Ä—Ç—Ö–∞–Ω–∞–ª—ã“õ –∂“±–º—ã—Å",
            "theory": "–ë“±–ª —Å–∞–±–∞“õ—Ç—ã“£ —Ç–µ–æ—Ä–∏—è–ª—ã“õ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–∞–π—ã–Ω–¥–∞–ª—É–¥–∞.",
            "lab": ("–†–µ–∞–∫—Ç–∏–≤ –ê + –†–µ–∞–∫—Ç–∏–≤ –ë", "–¢“Ø—Å—Ç—ñ“£ ”©–∑–≥–µ—Ä—É—ñ", "–ó–∞—Ç –∞–Ω—ã“õ—Ç–∞–ª–¥—ã"),
            "test": [("–°“±—Ä–∞“õ " + str(j), ["–ù“±—Å“õ–∞ –ê", "–ù“±—Å“õ–∞ –ë", "–ù“±—Å“õ–∞ –°"], 0) for j in range(1, 11)]
        }

# ---------------- UI ----------------
st.sidebar.title("üìò –•–∏–º–∏—è –∫—É—Ä—Å—ã")
lesson_num = int(st.sidebar.selectbox("–°–∞–±–∞“õ—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑", [f"{i}-—Å–∞–±–∞“õ" for i in range(1, 35)]).split("-")[0])
data = lesson_data[lesson_num]

st.title(f"üß™ {data['topic']}")

tab1, tab2, tab3 = st.tabs(["üìñ –¢–µ–æ—Ä–∏—è", "üî¨ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç", "üìù –¢–µ—Å—Ç (10 —Å“±—Ä–∞“õ)"])

with tab1:
    st.info(data['theory'])

with tab2:
    st.subheader("–í–∏—Ä—Ç—É–∞–ª–¥—ã –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è")
    
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    if 'poured' not in st.session_state:
        st.session_state.poured = False

    # CSS –∫–ª–∞—Å—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
    l_class = "pour-left" if st.session_state.poured else ""
    r_class = "pour-right" if st.session_state.poured else ""
    c_class = "fill-up" if st.session_state.poured else ""

    st.markdown(f"""
    <div class="scene">
        <div class="side-tube {l_class}"><div class="liquid-left"></div></div>
        <div class="main-tube"><div class="liquid-center {c_class}"></div></div>
        <div class="side-tube {r_class}"><div class="liquid-right"></div></div>
    </div>
    """, unsafe_allow_html=True)

    col1, col2 = st.columns(2)
    with col1:
        if st.button("–†–µ–∞–∫—Ü–∏—è–Ω—ã –±–∞—Å—Ç–∞—É"):
            st.session_state.poured = True
            st.rerun()
        if st.button("–¢–∞–∑–∞–ª–∞—É"):
            st.session_state.poured = False
            st.rerun()
    
    with col2:
        if st.session_state.poured:
            st.success(f"**–ë–∞“õ—ã–ª–∞—É:** {data['lab'][1]}")
            st.warning(f"**“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã:** {data['lab'][2]}")

with tab3:
    st.subheader("–ë—ñ–ª—ñ–º—ñ“£–¥—ñ —Ç–µ–∫—Å–µ—Ä")
    score = 0
    with st.form(key=f"test_form_{lesson_num}"):
        for idx, (q, opts, corr) in enumerate(data["test"]):
            ans = st.radio(f"{idx+1}. {q}", opts, key=f"q_{lesson_num}_{idx}")
            if opts.index(ans) == corr:
                score += 1
        
        submit = st.form_submit_box("–ù”ô—Ç–∏–∂–µ–Ω—ñ –µ—Å–µ–ø—Ç–µ—É")
        if submit:
            if score == 10:
                st.balloons()
                st.success(f"–ö–µ—Ä–µ–º–µ—Ç! 10/10")
            else:
                st.write(f"–°—ñ–∑–¥—ñ“£ “±–ø–∞–π—ã“£—ã–∑: {score} / 10")
