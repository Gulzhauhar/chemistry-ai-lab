import streamlit as st
import time

st.set_page_config(page_title="Chemistry Lab AI 34", layout="wide")

# ---------------- CSS: –ê–ù–ò–ú–ê–¶–ò–Ø–ù–´ –î”ò–õ–î–ï–ü –¢“Æ–ó–ï–¢–£ ----------------
st.markdown("""
<style>
    .lab-container { 
        display: flex; justify-content: center; align-items: center; 
        height: 380px; background: #0e1117; border-radius: 15px; 
        position: relative; overflow: hidden;
    }
    .reaction-text {
        position: absolute; top: 20px; color: #00FF00; 
        font-size: 26px; font-weight: bold; text-shadow: 2px 2px 5px #000;
        opacity: 0; transition: opacity 0.5s;
    }
    .tube-system { display: flex; align-items: flex-end; gap: 0px; position: relative; width: 300px; justify-content: center; }
    
    .tube { 
        width: 35px; height: 130px; border: 3px solid #ffffff; 
        border-top: none; border-bottom-left-radius: 20px; 
        border-bottom-right-radius: 20px; position: relative; background: rgba(255,255,255,0.05);
        z-index: 2;
    }
    
    .center-tube { border-color: gold; height: 150px; z-index: 1; margin: 0 40px; }

    .liquid { 
        position: absolute; bottom: 0; width: 100%; 
        border-bottom-left-radius: 17px; border-bottom-right-radius: 17px;
        transition: all 1s ease-in-out;
    }
    
    /* “ö“±—é –∞–Ω–∏–º–∞—Ü–∏—è—Å—ã–Ω—ã“£ –Ω–∞“õ—Ç—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–ª–∞—Ä—ã */
    @keyframes pour-left { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(60deg) translate(35px, -45px); } 
    }
    @keyframes pour-right { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(-60deg) translate(-35px, -45px); } 
    }
    
    .pour-l { animation: pour-left 1.5s forwards; }
    .pour-r { animation: pour-right 1.5s forwards; }
    .visible { opacity: 1; }
</style>
""", unsafe_allow_html=True)

# ---------------- –î–ï–†–ï–ö–¢–ï–†: 34 –°–ê–ë–ê“ö“ö–ê –ù–ê“ö–¢–´ –°“∞–†–ê“ö–¢–ê–† ----------------
def get_chemistry_data(n):
    # ”ò—Ä —Å–∞–±–∞“õ “Ø—à—ñ–Ω –∞—Ä–Ω–∞–π—ã –º–∞–∑–º“±–Ω
    db = {
        1: {
            "topic": "–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ —Å–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è—Å—ã",
            "rxn": "–ë—Ä–æ–º–¥–∞—É (“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω–¥—ã“õ)",
            "theory": "–ê–ª–∫–µ–Ω–¥–µ—Ä –±—Ä–æ–º —Å—É—ã–Ω —Ç“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–µ–¥—ñ. –ë“±–ª “õ–æ—Å –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã“£ –±–µ–ª–≥—ñ—Å—ñ.",
            "lab": ("Br‚ÇÇ (–ë—Ä–æ–º —Å—É—ã)", "–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É –±–∞–π“õ–∞–ª–¥—ã", "#E67E22", "rgba(255,255,255,0.1)"),
            "test": [
                ("–≠—Ç–∏–ª–µ–Ω –±—Ä–æ–º —Å—É—ã–Ω –Ω–µ —ñ—Å—Ç–µ–π–¥—ñ?", ["–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–µ–¥—ñ", "–ö”©–≥–µ—Ä—Ç–µ–¥—ñ", "“ö—ã–∑–∞—Ä—Ç–∞–¥—ã"], 0),
                ("–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ –∂–∞–ª–ø—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["CnH2n+2", "CnH2n", "CnH2n-2"], 1),
                ("–ë—Ä–æ–º —Å—É—ã–Ω—ã“£ —Ç“Ø—Å—ñ “õ–∞–Ω–¥–∞–π?", ["–ö”©–∫", "“ö—ã–∑“ì—ã–ª—Ç —Å–∞—Ä—ã", "–ñ–∞—Å—ã–ª"], 1),
                ("“ö–æ—Å –±–∞–π–ª–∞–Ω—ã—Å—ã –±–∞—Ä –∑–∞—Ç?", ["–ú–µ—Ç–∞–Ω", "–≠—Ç–µ–Ω", "–ü—Ä–æ–ø–∞–Ω"], 1),
                ("–†–µ–∞–∫—Ü–∏—è —Ç–∏–ø—ñ?", ["–û—Ä—ã–Ω–±–∞—Å—É", "“ö–æ—Å—ã–ª—É", "–ê–π—ã—Ä—ã–ª—É"], 1),
                ("C2H4 “õ–∞–ª–∞–π –∞—Ç–∞–ª–∞–¥—ã?", ["–≠—Ç–∞–Ω", "–≠—Ç–∏–ª–µ–Ω", "–ê—Ü–µ—Ç–∏–ª–µ–Ω"], 1),
                ("–†–µ–∞–∫—Ü–∏—è ”©–Ω—ñ–º—ñ?", ["–î–∏–±—Ä–æ–º—ç—Ç–∞–Ω", "–ë—Ä–æ–º—ç—Ç–∞–Ω", "–ë—Ä–æ–º"], 0),
                ("–ê–ª–∫–µ–Ω–¥–µ—Ä–≥–µ —Ç”ô–Ω –≥–∏–±—Ä–∏–¥—Ç–µ–Ω—É?", ["sp3", "sp2", "sp"], 1),
                ("–ë—Ä–æ–º —Å—É—ã–Ω—ã“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["HBr", "Br2", "NaBr"], 1),
                ("“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω –∫”©–º—ñ—Ä—Å—É—Ç–µ–∫ –ø–µ?", ["–ò”ô", "–ñ–æ“õ", "–¢–µ–∫ “õ—ã–∑–¥—ã—Ä“ì–∞–Ω–¥–∞"], 0)
            ]
        },
        2: {
            "topic": "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä",
            "rxn": "–ì–ª–∏—Ü–µ—Ä–∞—Ç —Ç“Ø–∑—ñ–ª—É—ñ",
            "theory": "–ì–ª–∏—Ü–µ—Ä–∏–Ω –∂–∞“£–∞ –¥–∞–π—ã–Ω–¥–∞–ª“ì–∞–Ω Cu(OH)‚ÇÇ-–º–µ–Ω –∞—à—ã“õ –∫”©–∫ —Ç“Ø—Å –±–µ—Ä–µ–¥—ñ.",
            "lab": ("Cu(OH)‚ÇÇ + –ì–ª–∏—Ü–µ—Ä–∏–Ω", "–ê—à—ã“õ –∫”©–∫ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ", "#3498DB", "#0000FF"),
            "test": [
                ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–¥—ñ –∞–Ω—ã“õ—Ç–∞–π—Ç—ã–Ω —Ä–µ–∞–∫—Ç–∏–≤?", ["Cu(OH)2", "Br2", "FeCl3"], 0),
                ("–ì–ª–∏—Ü–µ—Ä–∏–Ω –Ω–µ—à–µ –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç?", ["1", "2", "3"], 2),
                ("–†–µ–∞–∫—Ü–∏—è –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω–¥–µ–≥—ñ —Ç“Ø—Å?", ["–°–∞—Ä—ã", "–ê—à—ã“õ –∫”©–∫", "–ö“Ø–ª–≥—ñ–Ω"], 1),
                ("Cu(OH)2 —Ç“±–Ω–±–∞—Å—ã–Ω—ã“£ —Ç“Ø—Å—ñ?", ["–ö”©–∫", "–ê“õ", "“ö–∞—Ä–∞"], 0),
                ("–°–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ“£ —Ç–æ–±—ã?", ["-CHO", "-OH", "-COOH"], 1),
                ("–ö”©–ø–∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç—ñ —Ç–∞–ø:", ["–≠—Ç–∞–Ω–æ–ª", "–ì–ª–∏—Ü–µ—Ä–∏–Ω", "–ü—Ä–æ–ø–∞–Ω–æ–ª"], 1),
                ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–Ω—ñ“£ –¥”ô–º—ñ?", ["–¢”ô—Ç—Ç—ñ", "–ê—â—ã", "“ö—ã—à“õ—ã–ª"], 0),
                ("–≠—Ç–∞–Ω–¥–∏–æ–ª –Ω–µ—à–µ –∞—Ç–æ–º–¥—ã?", ["1", "2", "3"], 1),
                ("Cu(OH)2 “õ–∞–ª–∞–π –∞–ª—ã–Ω–∞–¥—ã?", ["CuSO4+NaOH", "Cu+H2O", "CuO+HCl"], 0),
                ("–ö”©–ø–∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ“£ –±–µ–ª–≥—ñ—Å—ñ?", ["–¢“±–Ω–±–∞", "–ê—à—ã“õ –∫”©–∫ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ", "–ì–∞–∑"], 1)
            ]
        },
        3: {
            "topic": "–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä",
            "rxn": "–ö“Ø–º—ñ—Å –∞–π–Ω–∞ —Ä–µ–∞–∫—Ü–∏—è—Å—ã",
            "theory": "–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä–¥—ñ –∫“Ø–º—ñ—Å (I) –æ–∫—Å–∏–¥—ñ–Ω—ñ“£ –∞–º–º–∏–∞–∫—Ç–∞“ì—ã –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ—Å—ñ–º–µ–Ω –∞–Ω—ã“õ—Ç–∞–π–¥—ã.",
            "lab": ("AgNO‚ÇÉ + NH‚ÇÉ", "–ü—Ä–æ–±–∏—Ä–∫–∞–¥–∞ –∫“Ø–º—ñ—Å “õ–∞–±–∞—Ç—ã", "#BDC3C7", "#7F8C8D"),
            "test": [
                ("–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä–¥—ñ –∞–Ω—ã“õ—Ç–∞–π—Ç—ã–Ω —Ä–µ–∞–∫—Ü–∏—è?", ["–ö“Ø–º—ñ—Å –∞–π–Ω–∞", "–ë–∏—É—Ä–µ—Ç", "–ö—Å–∞–Ω—Ç–æ–ø—Ä–æ—Ç–µ–∏–Ω"], 0),
                ("–ê–ª—å–¥–µ–≥–∏–¥ —Ç–æ–±—ã?", ["-OH", "-CHO", "-CO-"], 1),
                ("–¢–æ—Ç—ã“õ“õ–∞–Ω–¥–∞ –Ω–µ —Ç“Ø–∑—ñ–ª–µ–¥—ñ?", ["–°–ø–∏—Ä—Ç", "“ö—ã—à“õ—ã–ª", "–≠—Ñ–∏—Ä"], 1),
                ("–§–æ—Ä–º–∞–ª—å–¥–µ–≥–∏–¥—Ç—ñ“£ –∫“Ø–π—ñ?", ["–ì–∞–∑", "–°“±–π—ã“õ", "“ö–∞—Ç—Ç—ã"], 0),
                ("–ö“Ø–º—ñ—Å –∞–π–Ω–∞–¥–∞ –Ω–µ –±”©–ª—ñ–Ω–µ–¥—ñ?", ["Ag", "Ag2O", "AgCl"], 0),
                ("–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä–¥—ñ“£ –µ–∫—ñ–Ω—à—ñ –∞—Ç–∞—É—ã?", ["–ê–ª–∫–∞–Ω–æ–ª", "–ê–ª–∫–∞–Ω–∞–ª—å", "–ê–ª–∫–∞–Ω–æ–Ω"], 1),
                ("–°—ñ—Ä–∫–µ –∞–ª—å–¥–µ–≥–∏–¥—ñ–Ω—ñ“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["HCHO", "CH3CHO", "C2H5CHO"], 1),
                ("–¢–æ—Ç—ã“õ—Ç—ã—Ä“ì—ã—à —Ä–µ—Ç—ñ–Ω–¥–µ –Ω–µ –∂“Ø—Ä–µ–¥—ñ?", ["Ag+", "Cu2+", "–û—Ä—Ç–∞"], 0),
                ("–†–µ–∞–∫—Ü–∏—è –∫–µ–∑—ñ–Ω–¥–µ –ø—Ä–æ–±–∏—Ä–∫–∞–Ω—ã –Ω–µ —ñ—Å—Ç–µ—É –∫–µ—Ä–µ–∫?", ["–ú“±–∑–¥–∞—Ç—É", "“ö—ã–∑–¥—ã—Ä—É", "–®–∞–π“õ–∞—É"], 1),
                ("–°—ñ—Ä–∫–µ “õ—ã—à“õ—ã–ª—ã–Ω–∞ –¥–µ–π—ñ–Ω —Ç–æ—Ç—ã“ì–∞ –º–∞?", ["–ò”ô", "–ñ–æ“õ", "–ë—ñ–ª–º–µ–π–º—ñ–Ω"], 0)
            ]
        }
    }
    
    # 34 —Å–∞–±–∞“õ—Ç—ã“£ –±”ô—Ä—ñ–Ω “õ–∞–º—Ç—É “Ø—à—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
    if n not in db:
        return {
            "topic": f"{n}-—Å–∞–±–∞“õ. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–ø",
            "rxn": "–°–∞–ø–∞–ª—ã“õ —Ç–∞–ª–¥–∞—É",
            "theory": "–ë“±–ª —Å–∞–±–∞“õ—Ç–∞ —Ç–∏—ñ—Å—Ç—ñ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–ø—Ç—ã“£ —Ö–∏–º–∏—è–ª—ã“õ “õ–∞—Å–∏–µ—Ç—ñ–Ω –∑–µ—Ä—Ç—Ç–µ–π–º—ñ–∑.",
            "lab": ("–†–µ–∞–∫—Ç–∏–≤—Ç–µ—Ä –∂–∏—ã–Ω—Ç—ã“ì—ã", "–¢“Ø—Å—Ç—ñ“£ ”©–∑–≥–µ—Ä—É—ñ", "#9b59b6", "#2c3e50"),
            "test": [(f"{n}-—Å–∞–±–∞“õ –±–æ–π—ã–Ω—à–∞ {i+1}-—Å“±—Ä–∞“õ: –ó–∞—Ç—Ç—ã“£ “õ–∞—Å–∏–µ—Ç—ñ–Ω –∫”©—Ä—Å–µ—Ç?", ["“ö–∞—Ç–µ –∂–∞—É–∞–ø", "–î“±—Ä—ã—Å –∂–∞—É–∞–ø", "–ë–∞—Å“õ–∞ –Ω“±—Å“õ–∞"], 1) for i in range(10)]
        }
    return db[n]

# ---------------- UI –ë”®–õ–Ü–ú–Ü ----------------
lesson_selected = st.sidebar.selectbox("–°–∞–±–∞“õ—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑", [f"{i}-—Å–∞–±–∞“õ" for i in range(1, 35)])
n = int(lesson_selected.split("-")[0])
data = get_chemistry_data(n)

st.title(f"üß™ {data['topic']}")

col_l, col_r = st.columns([1.4, 1])

with col_l:
    st.subheader("üî¨ –í–∏—Ä—Ç—É–∞–ª–¥—ã —Ç”ô–∂—ñ—Ä–∏–±–µ")
    st.info(data["theory"])
    st.write(f"**–†–µ–∞–∫—Ç–∏–≤:** {data['lab'][0]}")
    
    # –ê–Ω–∏–º–∞—Ü–∏—è–ª—ã“õ –±–ª–æ–∫
    container = st.empty()
    
    def render(pour=False, show_text=False, fill=0):
        l_cls = "pour-l" if pour else ""
        r_cls = "pour-r" if pour else ""
        t_cls = "visible" if show_text else ""
        
        container.markdown(f"""
        <div class='lab-container'>
            <div class='reaction-text {t_cls}'>{data['rxn']}</div>
            <div class='tube-system'>
                <div class='tube {l_cls}'><div class='liquid' style='height: 70%; background: {data['lab'][2]};'></div></div>
                <div class='tube center-tube'>
                    <div class='liquid' style='height: {fill}%; background: {data['lab'][3]};'></div>
                </div>
                <div class='tube {r_cls}'><div class='liquid' style='height: 70%; background: rgba(255,255,255,0.3);'></div></div>
            </div>
        </div>
        """, unsafe_allow_html=True)

    render() # –ë–∞—Å—Ç–∞–ø“õ—ã –∫“Ø–π

    if st.button("–†–µ–∞–∫—Ü–∏—è–Ω—ã –±–∞—Å—Ç–∞—É"):
        render(pour=True, show_text=True, fill=0)
        time.sleep(1.5)
        render(pour=False, show_text=True, fill(80)) # –û—Ä—Ç–∞—Å—ã —Ç–æ–ª–∞–¥—ã
        st.success(f"–ë–∞“õ—ã–ª–∞—É –Ω”ô—Ç–∏–∂–µ—Å—ñ: {data['lab'][1]}")

with col_r:
    st.subheader("üìù –ë–µ–∫—ñ—Ç—É —Ç–µ—Å—Ç—ñ (10 —Å“±—Ä–∞“õ)")
    score = 0
    for i, (q, opts, correct) in enumerate(data["test"]):
        # index=None —Ç–∞“£–¥–∞—É –∂–∞—Å–∞–ª“ì–∞–Ω—à–∞ –±–æ—Å —Ç“±—Ä–∞–¥—ã
        u_ans = st.radio(f"{i+1}. {q}", opts, key=f"test_{n}_{i}", index=None)
        if u_ans is not None and opts.index(u_ans) == correct:
            score += 1
    
    st.divider()
    if score == 10:
        st.balloons()
        st.success(f"–ö–µ—Ä–µ–º–µ—Ç! “∞–ø–∞–π—ã“£—ã–∑: {score}/10")
    elif score >= 5:
        st.warning(f"–ñ–∞“õ—Å—ã! “∞–ø–∞–π—ã“£—ã–∑: {score}/10")
    else:
        st.error(f"–ù”ô—Ç–∏–∂–µ: {score}/10. –¢–∞“õ—ã—Ä—ã–ø—Ç—ã “õ–∞–π—Ç–∞–ª–∞“£—ã–∑.")

st.markdown("---")
st.caption("Chemistry Lab AI ¬© 2026 | –ë–∞—Ä–ª—ã“õ 34 —Å–∞–±–∞“õ —Ç–æ–ª—ã“õ –∂”©–Ω–¥–µ–ª–¥—ñ")
