import streamlit as st
import time

st.set_page_config(page_title="Chemistry Lab AI 34", layout="wide")

# ---------------- CSS: –ñ”®–ù–î–ï–õ–ì–ï–ù –ê–ù–ò–ú–ê–¶–ò–Ø (“ö–ê–ô–¢–ê –Ü–°–ö–ï “ö–û–°–£ –ñ”ò–ù–ï –ë–ò–Ü–ö–¢–Ü–ö) ----------------
st.markdown("""
<style>
    .lab-container { 
        display: flex; justify-content: center; align-items: center; 
        height: 400px; background: #0e1117; border-radius: 15px; 
        position: relative; overflow: hidden; border: 1px solid #444;
    }
    .reaction-text {
        position: absolute; top: 25px; color: #00FF00; 
        font-size: 26px; font-weight: bold; text-shadow: 0 0 10px #000;
        opacity: 0; transition: opacity 0.5s; z-index: 10;
    }
    .tube-system { display: flex; align-items: flex-end; position: relative; width: 450px; justify-content: center; }
    
    .tube { 
        width: 40px; height: 130px; border: 3px solid #ffffff; 
        border-top: none; border-bottom-left-radius: 20px; 
        border-bottom-right-radius: 20px; position: relative; background: rgba(255,255,255,0.1);
    }
    
    .center-tube { border-color: gold; height: 150px; margin: 0 30px; z-index: 5; }

    .liquid { 
        position: absolute; bottom: 0; width: 100%; 
        border-bottom-left-radius: 17px; border-bottom-right-radius: 17px;
        transition: all 1s ease-in-out;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è: –ë–∏—ñ–∫–∫–µ –∫”©—Ç–µ—Ä—ñ–ª—ñ–ø, –¥”ô–ª “õ“±—é */
    .active-l { animation: pour-left-final 1.5s forwards; }
    .active-r { animation: pour-right-final 1.5s forwards; }
    
    @keyframes pour-left-final {
        0% { transform: translateY(0) rotate(0); }
        40% { transform: translateY(-60px) rotate(0); }
        100% { transform: translateY(-60px) translateX(55px) rotate(75deg); }
    }
    @keyframes pour-right-final {
        0% { transform: translateY(0) rotate(0); }
        40% { transform: translateY(-60px) rotate(0); }
        100% { transform: translateY(-60px) translateX(-55px) rotate(-75deg); }
    }
    
    .visible { opacity: 1; }
</style>
""", unsafe_allow_html=True)

# ---------------- –î–ï–†–ï–ö–¢–ï–†: “ö–ê–ó–ê“ö–®–ê –°“∞–†–ê“ö–¢–ê–† –ú–ï–ù –¢–ê“ö–´–†–´–ü–¢–ê–† ----------------
def get_chemistry_content(n):
    lessons_db = {
        1: {
            "topic": "–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ —Å–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è—Å—ã",
            "rxn": "–ë—Ä–æ–º —Å—É—ã–Ω —Ç“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä—É",
            "theory": "–ê–ª–∫–µ–Ω–¥–µ—Ä –±—Ä–æ–º —Å—É—ã–Ω (Br‚ÇÇ) “õ–æ—Å—ã–ø –∞–ª—É —Ä–µ–∞–∫—Ü–∏—è—Å—ã –∞—Ä“õ—ã–ª—ã —Ç“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–µ–¥—ñ.",
            "lab": ("Br‚ÇÇ", "–ï—Ä—ñ—Ç—ñ–Ω–¥—ñ –º”©–ª–¥—ñ—Ä –±–æ–ª–¥—ã", "#E67E22", "rgba(255,255,255,0.1)"),
            "test": [
                ("–≠—Ç–∏–ª–µ–Ω –±—Ä–æ–º —Å—É—ã–Ω –Ω–µ —ñ—Å—Ç–µ–π–¥—ñ?", ["–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω–¥—ñ—Ä–µ–¥—ñ", "“ö—ã–∑–∞—Ä—Ç–∞–¥—ã", "–¢“±–Ω–±–∞ –±–µ—Ä–µ–¥—ñ"], 0),
                ("–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ –∂–∞–ª–ø—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["CnH2n+2", "CnH2n", "CnH2n-2"], 1),
                ("–ë—Ä–æ–º —Å—É—ã–º–µ–Ω —Ä–µ–∞–∫—Ü–∏—è —Ç“Ø—Ä—ñ?", ["–û—Ä—ã–Ω–±–∞—Å—É", "“ö–æ—Å—ã–ª—É", "–ê–π—ã—Ä—ã–ª—É"], 1),
                ("–ë—Ä–æ–º —Å—É—ã–Ω—ã“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["HBr", "Br2", "NaBr"], 1),
                ("“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω –∫”©–º—ñ—Ä—Å—É—Ç–µ–∫—Ç—ñ —Ç–∞–ø:", ["–ú–µ—Ç–∞–Ω", "–≠—Ç–µ–Ω", "–ü—Ä–æ–ø–∞–Ω"], 1)
            ]
        },
        2: {
            "topic": "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä",
            "rxn": "–ì–ª–∏—Ü–µ—Ä–∞—Ç —Ç“Ø–∑—ñ–ª—É—ñ",
            "theory": "–ì–ª–∏—Ü–µ—Ä–∏–Ω Cu(OH)‚ÇÇ-–º–µ–Ω ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Å—ñ–ø, –∞—à—ã“õ –∫”©–∫ —Ç“Ø—Å—Ç—ñ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ —Ç“Ø–∑–µ–¥—ñ.",
            "lab": ("Cu(OH)‚ÇÇ + –ì–ª–∏—Ü–µ—Ä–∏–Ω", "–ê—à—ã“õ –∫”©–∫ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ", "#3498DB", "#0000FF"),
            "test": [
                ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–¥—ñ –∞–Ω—ã“õ—Ç–∞–π—Ç—ã–Ω —Ä–µ–∞–∫—Ç–∏–≤?", ["Cu(OH)2", "AgNO3", "Br2"], 0),
                ("–ì–ª–∏—Ü–µ—Ä–∏–Ω –Ω–µ—à–µ –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç?", ["1", "2", "3"], 2),
                ("–†–µ–∞–∫—Ü–∏—è –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω–¥–µ–≥—ñ —Ç“Ø—Å?", ["“ö—ã–∑—ã–ª", "–ê—à—ã“õ –∫”©–∫", "–°–∞—Ä—ã"], 1)
            ]
        },
        3: {
            "topic": "–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä",
            "rxn": "–ö“Ø–º—ñ—Å –∞–π–Ω–∞ —Ä–µ–∞–∫—Ü–∏—è—Å—ã",
            "theory": "–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä –∫“Ø–º—ñ—Å –æ–∫—Å–∏–¥—ñ–Ω—ñ“£ –∞–º–º–∏–∞–∫—Ç–∞“ì—ã –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ—Å—ñ–º–µ–Ω —Ç–æ—Ç—ã“ì—ã–ø, –∫“Ø–º—ñ—Å —Ç“±–Ω–¥—ã—Ä–∞–¥—ã.",
            "lab": ("AgNO‚ÇÉ + NH‚ÇÉ", "–ö“Ø–º—ñ—Å –∞–π–Ω–∞ –ø–∞–π–¥–∞ –±–æ–ª–¥—ã", "#BDC3C7", "#7F8C8D"),
            "test": [
                ("–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä–≥–µ —Ç”ô–Ω —Ä–µ–∞–∫—Ü–∏—è?", ["–ö“Ø–º—ñ—Å –∞–π–Ω–∞", "–ë–∏—É—Ä–µ—Ç", "–ë—Ä–æ–º–¥–∞—É"], 0),
                ("–ê–ª—å–¥–µ–≥–∏–¥ —Ç–æ–±—ã–Ω –∫”©—Ä—Å–µ—Ç:", ["-OH", "-CHO", "-COOH"], 1),
                ("–¢–æ—Ç—ã“õ“õ–∞–Ω–¥–∞ –Ω–µ —Ç“Ø–∑—ñ–ª–µ–¥—ñ?", ["–°–ø–∏—Ä—Ç", "–ö–∞—Ä–±–æ–Ω “õ—ã—à“õ—ã–ª—ã", "–≠—Ñ–∏—Ä"], 1),
                ("–§–æ—Ä–º–∞–ª—å–¥–µ–≥–∏–¥—Ç—ñ“£ –µ–∫—ñ–Ω—à—ñ –∞—Ç—ã?", ["“ö“±–º—ã—Ä—Å“õ–∞ –∞–ª—å–¥–µ–≥–∏–¥—ñ", "–°—ñ—Ä–∫–µ –∞–ª—å–¥–µ–≥–∏–¥—ñ", "–ü—Ä–æ–ø–∞–Ω–∞–ª—å"], 0),
                ("–ö“Ø–º—ñ—Å –∞–π–Ω–∞–¥–∞ “õ–∞–Ω–¥–∞–π –º–µ—Ç–∞–ª–ª –±”©–ª—ñ–Ω–µ–¥—ñ?", ["–ú—ã—Å", "–ö“Ø–º—ñ—Å", "–ê–ª—Ç—ã–Ω"], 1),
                ("–°—ñ—Ä–∫–µ –∞–ª—å–¥–µ–≥–∏–¥—ñ–Ω—ñ“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["HCHO", "CH3CHO", "C2H5CHO"], 1),
                ("–ê–ª—å–¥–µ–≥–∏–¥—Ç–µ—Ä “õ–∞–Ω–¥–∞–π “õ–∞—Å–∏–µ—Ç –∫”©—Ä—Å–µ—Ç–µ–¥—ñ?", ["–¢–æ—Ç—ã“õ—Ç—ã—Ä“ì—ã—à", "–¢–æ—Ç—ã“õ—Å—ã–∑–¥–∞–Ω–¥—ã—Ä“ì—ã—à", "–ë–µ–π—Ç–∞—Ä–∞–ø"], 1),
                ("–ö–∞—Ä–±–æ–Ω–∏–ª —Ç–æ–±—ã –¥–µ–≥–µ–Ω –Ω–µ?", [">C=O", "-OH", "-NH2"], 0),
                ("–ú–µ—Ç–∞–Ω–∞–ª—å “õ–∞–Ω–¥–∞–π –∞–≥—Ä–µ–≥–∞—Ç—Ç—ã“õ –∫“Ø–π–¥–µ?", ["–ì–∞–∑", "–°“±–π—ã“õ", "“ö–∞—Ç—Ç—ã"], 0),
                ("–¢–æ—Ç—ã“ì—É ”©–Ω—ñ–º—ñ —Å—ñ—Ä–∫–µ “õ—ã—à“õ—ã–ª—ã –±–æ–ª–∞—Ç—ã–Ω –∑–∞—Ç?", ["–ú–µ—Ç–∞–Ω–∞–ª—å", "–≠—Ç–∞–Ω–∞–ª—å", "–ü—Ä–æ–ø–∞–Ω–∞–ª—å"], 1)
            ]
        },
        4: {
            "topic": "–ö–∞—Ä–±–æ–Ω “õ—ã—à“õ—ã–ª–¥–∞—Ä—ã",
            "rxn": "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä–¥—ã“£ ”©–∑–≥–µ—Ä—É—ñ",
            "theory": "“ö—ã—à“õ—ã–ª–¥—ã“õ –æ—Ä—Ç–∞–¥–∞ –ª–∞–∫–º—É—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã “õ—ã–∑—ã–ª —Ç“Ø—Å–∫–µ –±–æ—è–ª–∞–¥—ã.",
            "lab": ("CH‚ÇÉCOOH + –õ–∞–∫–º—É—Å", "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä “õ—ã–∑–∞—Ä–¥—ã", "#9B59B6", "#E74C3C"),
            "test": [
                ("“ö—ã—à“õ—ã–ª —Ç–æ–±—ã “õ–∞–ª–∞–π –∞—Ç–∞–ª–∞–¥—ã?", ["–ì–∏–¥—Ä–æ–∫—Å–∏–ª", "–ö–∞—Ä–±–æ–∫—Å–∏–ª", "–ö–∞—Ä–±–æ–Ω–∏–ª"], 1),
                ("–°—ñ—Ä–∫–µ “õ—ã—à“õ—ã–ª—ã–Ω–¥–∞ –ª–∞–∫–º—É—Å —Ç“Ø—Å—ñ?", ["–ö”©–∫", "“ö—ã–∑—ã–ª", "–ö“Ø–ª–≥—ñ–Ω"], 1),
                ("“ö“±–º—ã—Ä—Å“õ–∞ “õ—ã—à“õ—ã–ª—ã–Ω—ã“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", ["HCOOH", "CH3COOH", "C2H5COOH"], 0)
            ]
        },
        5: {
            "topic": "–ê“õ—É—ã–∑–¥–∞—Ä (–ë–µ–ª–æ–∫—Ç–∞—Ä)",
            "rxn": "–ë–∏—É—Ä–µ—Ç —Ä–µ–∞–∫—Ü–∏—è—Å—ã",
            "theory": "–ê“õ—É—ã–∑–¥–∞—Ä–¥—ã Cu(OH)‚ÇÇ-–º–µ–Ω –∞–Ω—ã“õ—Ç–∞“ì–∞–Ω–¥–∞ –∫“Ø–ª–≥—ñ–Ω —Ç“Ø—Å –ø–∞–π–¥–∞ –±–æ–ª–∞–¥—ã.",
            "lab": ("–ê“õ—É—ã–∑ + Cu(OH)‚ÇÇ", "–ö“Ø–ª–≥—ñ–Ω —Ç“Ø—Å –ø–∞–π–¥–∞ –±–æ–ª–¥—ã", "#3498DB", "#8E44AD"),
            "test": [
                ("–ü–µ–ø—Ç–∏–¥—Ç—ñ–∫ –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã –∞–Ω—ã“õ—Ç–∞–π—Ç—ã–Ω —Ä–µ–∞–∫—Ü–∏—è?", ["–ö—Å–∞–Ω—Ç–æ–ø—Ä–æ—Ç–µ–∏–Ω", "–ë–∏—É—Ä–µ—Ç", "–ö“Ø–º—ñ—Å –∞–π–Ω–∞"], 1),
                ("–ê“õ—É—ã–∑“ì–∞ Cu(OH)2 “õ–æ—Å“õ–∞–Ω–¥–∞“ì—ã —Ç“Ø—Å?", ["–°–∞—Ä—ã", "–ö“Ø–ª–≥—ñ–Ω", "–ñ–∞—Å—ã–ª"], 1),
                ("–ê“õ—É—ã–∑ –Ω–µ–¥–µ–Ω —Ç“±—Ä–∞–¥—ã?", ["–ú–∞–π “õ—ã—à“õ—ã–ª—ã", "–ê–º–∏–Ω“õ—ã—à“õ—ã–ª–¥–∞—Ä—ã", "–ì–ª—é–∫–æ–∑–∞"], 1)
            ]
        }
    }
    
    if n not in lessons_db:
        return {
            "topic": f"{n}-—Å–∞–±–∞“õ. –•–∏–º–∏—è–ª—ã“õ —Ç–∞–ª–¥–∞—É",
            "rxn": "–¢–∞–ª–¥–∞—É —Ä–µ–∞–∫—Ü–∏—è—Å—ã",
            "theory": f"{n}-—Ç–∞“õ—ã—Ä—ã–ø –±–æ–π—ã–Ω—à–∞ —Ö–∏–º–∏—è–ª—ã“õ “õ–∞—Å–∏–µ—Ç—Ç–µ—Ä–¥—ñ –∑–µ—Ä—Ç—Ç–µ—É.",
            "lab": ("–†–µ–∞–∫—Ç–∏–≤", "–¢“Ø—Å—Ç—ñ“£ ”©–∑–≥–µ—Ä—É—ñ", "#9b59b6", "#2c3e50"),
            "test": [(f"{n}-—Å–∞–±–∞“õ –±–æ–π—ã–Ω—à–∞ {i+1}-—Å“±—Ä–∞“õ?", ["–ù“±—Å“õ–∞ 1", "–î“±—Ä—ã—Å –∂–∞—É–∞–ø", "–ù“±—Å“õ–∞ 3"], 1) for i in range(10)]
        }
    return lessons_db[n]

# ---------------- LOGIC ----------------
lesson_selected = st.sidebar.selectbox("–°–∞–±–∞“õ—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑", [f"{i}-—Å–∞–±–∞“õ" for i in range(1, 35)])
n = int(lesson_selected.split("-")[0])
data = get_chemistry_content(n)

st.title(f"üß™ {data['topic']}")

col_ani, col_quiz = st.columns([1.5, 1])

with col_ani:
    st.subheader("üî¨ –í–∏—Ä—Ç—É–∞–ª–¥—ã –∑–µ—Ä—Ç—Ö–∞–Ω–∞")
    
    # –ê–Ω–∏–º–∞—Ü–∏—è –∫“Ø–π—ñ–Ω —Å–∞“õ—Ç–∞—É
    if f'active_{n}' not in st.session_state:
        st.session_state[f'active_{n}'] = False

    l_cls = "active-l" if st.session_state[f'active_{n}'] else ""
    r_cls = "active-r" if st.session_state[f'active_{n}'] else ""
    t_cls = "visible" if st.session_state[f'active_{n}'] else ""
    fill = 80 if st.session_state[f'active_{n}'] else 0

    st.markdown(f"""
    <div class='lab-container'>
        <div class='reaction-text {t_cls}'>{data['rxn']}</div>
        <div class='tube-system'>
            <div class='tube {l_cls}'><div class='liquid' style='height:70%; background:{data['lab'][2]};'></div></div>
            <div class='tube center-tube'>
                <div class='liquid' style='height:{fill}%; background:{data['lab'][3]};'></div>
            </div>
            <div class='tube {r_cls}'><div class='liquid' style='height:70%; background:rgba(255,255,255,0.3);'></div></div>
        </div>
    </div>
    """, unsafe_allow_html=True)

    if st.button("–†–µ–∞–∫—Ü–∏—è–Ω—ã –±–∞—Å—Ç–∞—É", key="btn_run", use_container_width=True):
        st.session_state[f'active_{n}'] = True
        st.rerun() # –ê–Ω–∏–º–∞—Ü–∏—è–Ω—ã “õ–∞–π—Ç–∞ —ñ—Å–∫–µ “õ–æ—Å—É “Ø—à—ñ–Ω –±–µ—Ç—Ç—ñ –∂–∞“£–∞—Ä—Ç—É

    if st.button("–¢–∞–∑–∞–ª–∞—É (–°–±—Ä–æ—Å)", key="btn_reset", use_container_width=True):
        st.session_state[f'active_{n}'] = False
        st.rerun()

    if st.session_state[f'active_{n}']:
        st.success(f"–ù”ô—Ç–∏–∂–µ: {data['lab'][1]}")

with col_quiz:
    st.subheader("üìù –ë–µ–∫—ñ—Ç—É —Ç–µ—Å—Ç—ñ (“ö–∞–∑–∞“õ—à–∞)")
    score = 0
    for i, (q, opts, correct) in enumerate(data["test"]):
        ans = st.radio(f"{i+1}. {q}", opts, key=f"q_{n}_{i}", index=None)
        if ans is not None and opts.index(ans) == correct:
            score += 1
            
    st.divider()
    st.write(f"üìä “∞–ø–∞–π—ã“£—ã–∑: **{score} / {len(data['test'])}**")
    if score == len(data['test']): st.balloons()

st.markdown("---")
st.caption("Chemistry Lab AI ¬© 2026 | –ë–∞—Ä–ª—ã“õ —Å“±—Ä–∞“õ—Ç–∞—Ä “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω–¥–µ | –ê–Ω–∏–º–∞—Ü–∏—è –∂”©–Ω–¥–µ–ª–¥—ñ")
